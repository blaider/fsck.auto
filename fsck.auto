#!/bin/bash
#echo $*

export PATH=${PATH:-/bin:/usr/bin:/usr/local/bin:/sbin:/usr/sbin:/usr/local/sbin}

if ! which which >/dev/null; then
    which() { 
        for i in $(echo $PATH | tr : ' '); do
            if [ -x $i/$1 ]; then echo $i/$1; return 0; fi;
        done
        return 1
    }
fi

for idx in 0 $(seq $#); do
    name=`eval echo -n "$"$idx`
    if [ -b $name ];then
	DEVNODE=$name
    fi
done
#echo $DEVNODE
if [ "$DEVNODE"x == ""x ];then
    echo "device find error"
    exit 1
fi
if which lsblk >/dev/null; then
    FSTYPE=$(lsblk -f $DEVNODE | tail -1 | awk '{print $2}')
elif which blkid >/dev/null; then
    FSTYPE=$(blkid $DEVNODE | sed -ne 's/.* TYPE="\([^"]*\)" .*/\1/p')
else
    echo "ERROR: lsblk or blkid is required, abort"
    exit 1
fi
#echo $DEVNODE  $FSTYPE
CMD=fsck."${FSTYPE}"
echo $CMD $*
$CMD $*
exit $?
